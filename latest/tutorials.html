<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Retrieve Einstein BotBuilder bot metadata &mdash; BotSIM  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Remediator Dashboard Navigation" href="dashboard.html" />
    <link rel="prev" title="Configuration" href="deep_dive.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> BotSIM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">What is BotSIM?</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#botsim-architecture">BotSIM  Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#botsim-system-design">BotSIM System Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#running-streamlit-app">Running Streamlit App</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deep-dive</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deep_dive.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="deep_dive.html#generator">Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="deep_dive.html#simulator">Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="deep_dive.html#remediator">Remediator</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Retrieve Einstein BotBuilder bot metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="#streamlit-web-app">Streamlit Web App</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#simulation-setup">1. Simulation Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upload-inputs">2. Upload Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dialog-generation-and-simulation">3. Dialog Generation and Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#health-reports-and-analytics">4. Health Reports and Analytics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#botsim-command-line-tools">BotSIM command line tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#step-1-prepare-botsim-configuration-file">Step 1: Prepare BotSIM configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stage-2-generation">Stage 2: Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-dialog-simulation">Step 3: Dialog Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stage-4-analyse-and-remediate">Stage 4: Analyse and Remediate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Remediator Dashboard Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html#apply-intent-model-remediation-suggestions">Apply intent model remediation suggestions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="advanced_usage.html">Extending BotSIM to new bot platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_usage.html#incorporating-advanced-models">Incorporating advanced models</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BotSIM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Retrieve Einstein BotBuilder bot metadata</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorials.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="retrieve-einstein-botbuilder-bot-metadata">
<h1>Retrieve Einstein BotBuilder bot metadata<a class="headerlink" href="#retrieve-einstein-botbuilder-bot-metadata" title="Permalink to this heading"></a></h1>
<p>There are two inputs required by BotSIM for dialog simulation with the Einstein BotBuilder platform:</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">botVersions</span></code> metadata contains dialog flows, bot messages,  entities, etc. It also includes  intents and their training utterances (if intent sets not used). If intent sets are used, it defines the references to the respective intent sets for all intents. The utterances in the intent sets are to be extracted from MlDomains metadata)</p>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span> <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
 <span class="nt">&lt;Package</span> <span class="na">xmlns=</span><span class="s">&quot;http://soap.sforce.com/2006/04/metadata&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;types&gt;</span>
      <span class="nt">&lt;members&gt;</span>Your-Bot-API-Name<span class="nt">&lt;/members&gt;</span>
      <span class="nt">&lt;name&gt;</span>Bot<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;/types&gt;</span>
  <span class="nt">&lt;version&gt;</span>51.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/Package&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>An example <code class="docutils literal notranslate"><span class="pre">package.xml</span></code> for extracting  the botversions metadata of a bot named “Your-Bot-API-Name” is given above.
The bot API name can be found under the bot “Overview” page. Replace “Your-Bot-API-Name” with the test bot API name and login to <a class="reference external" href="https://workbench.developerforce.com/login.php">Salesforce Workbench</a>
to retrieve the “botVersions” metadata.
By default, the “botversion” metadata is extracted as unpackaged/bot/&lt;bot-name&gt;.bot, where &lt;bot-name&gt; is the API name of the bot (the &lt;members&gt; field in package.xml).
The raw metadata is a XML file to be parsed later so that we can extract the dialog designs/flows, intents, entities for BotSIM to use.</p>
<p>2. <code class="docutils literal notranslate"><span class="pre">MlDomain</span></code> metadata contains all intent sets. Each intent set contains a set of training utterances that can be used to train (if NLP bot is enabled) certain intents.
Like the previous metadata, a “package.xml” can be used to retrieve the intent set metadata.</p>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span> <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
 <span class="nt">&lt;Package</span> <span class="na">xmlns=</span><span class="s">&quot;http://soap.sforce.com/2006/04/metadata&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;types&gt;</span>
      <span class="nt">&lt;members&gt;</span>Your-Intent-Set_Name<span class="nt">&lt;/members&gt;</span>
      <span class="nt">&lt;name&gt;</span>MlDomain<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;/types&gt;</span>
  <span class="nt">&lt;version&gt;</span>51.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/Package&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>By default, after unzipping, the <code class="docutils literal notranslate"><span class="pre">MLDomain</span></code> metadata is also extracted under  unpackaged/mlDomains. The mlDomains xml files are laster parsed to get the training utterances for all intents.</p>
<p>3. <strong>[Optional] Preparing evaluation intent utterances.</strong> To test and monitor the intent model performance, it is advised to hold-out a set of intent queries as the evaluation set, although the set can be created automatically by taking a subset of the paraphrases from the intent training utterances in mlDomain. Alternatively, an evaluation set can also be created from production chat logs.  The purpose of the evaluation set is to evaluate and monitor the intent model performance after each model update. For example, if customers want to update the intent model with new user utterances, they might want to see how this affect the intent model performance compared to  previous versions by running the dialog simulation on the same evaluation set.
If the evaluation utterances are not explicitly provided, the paraphrases of the training utterances will be randomly divided into two sets for development and evaluation purposes.</p>
</section>
<section id="streamlit-web-app">
<h1>Streamlit Web App<a class="headerlink" href="#streamlit-web-app" title="Permalink to this heading"></a></h1>
<p>BotSIM Streamlit App is a multi-page app developed to lower the entry barrier of applying BotSIM to bot evaluation and remediation. The App is supported
by the Python Flask API server running the following services:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">botsim_generation</span></code> is the generation service to parse input, apply paraphrasing models, generate dialog goals</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">botsim_simulation</span></code> is the simulation service to perform agenda-based user simulation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">botsim_remediation</span></code> is the remediation service to perform analysis and aggregate dashboard reports.</p></li>
</ul>
<section id="simulation-setup">
<h2>1. Simulation Setup<a class="headerlink" href="#simulation-setup" title="Permalink to this heading"></a></h2>
<a class="reference internal image-reference" href="_images/simulation_setup.png"><img alt="_images/simulation_setup.png" src="_images/simulation_setup.png" style="width: 550px;" /></a>
<p>This page is to guide users to provide the simulation configuration parameters.</p>
<p>The input options from the left panel include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Bot</span> <span class="pre">Platform</span></code> allows users to choose their own bot platform type, currently supporting <code class="docutils literal notranslate"><span class="pre">Einstein_Bot</span></code> and <code class="docutils literal notranslate"><span class="pre">DialogFlow_CX</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Bot</span> <span class="pre">Name</span></code> is the name of the bot</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Text</span> <span class="pre">Description</span></code> allows users to write “commit messages” of the simulation to be performed. This is to keep track of the bot testing sessions to better compare the historical performance. For example, “adding more intent training utterances for Report_an_Issue”.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">Dialog</span> <span class="pre">Generation</span> <span class="pre">&amp;</span> <span class="pre">Simulation</span> <span class="pre">Configuration</span></code> inputs on the page include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">No.</span> <span class="pre">of</span> <span class="pre">seed</span> <span class="pre">utterances</span></code> is the number of intent utterances for each intent to be used for generating paraphrase intent queries. The default value
“-1” means to use all intent utterances.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">No.</span> <span class="pre">of</span> <span class="pre">paraphrases</span></code> is the number of paraphrases to be generated for each intent utterance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">No.</span> <span class="pre">of</span> <span class="pre">dialog</span> <span class="pre">simulations</span></code> is the number of dialog simulation episodes allowed for each intent. Default value “-1” means using all the paraphrases.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Maximum</span> <span class="pre">No.</span> <span class="pre">of</span> <span class="pre">dialog</span> <span class="pre">turns</span></code> is to control the simulation runtime. When exceeding the maximum number of dialog turns, the episide is considered a failed conversation.</p></li>
</ul>
<p>Lastly, users need to upload their API crendentials for BotSIM to perform dialog user simulation.</p>
</section>
<section id="upload-inputs">
<h2>2. Upload Inputs<a class="headerlink" href="#upload-inputs" title="Permalink to this heading"></a></h2>
<a class="reference internal image-reference" href="_images/simulation_inputs.png"><img alt="_images/simulation_inputs.png" src="_images/simulation_inputs.png" style="width: 550px;" /></a>
<p>For <code class="docutils literal notranslate"><span class="pre">Einstein_Bot</span></code>, users need to upload the <code class="docutils literal notranslate"><span class="pre">botversions</span></code> and <code class="docutils literal notranslate"><span class="pre">mldomains</span></code> metadata. Upon uploading, the metadata is parsed to generate the dialog act maps
and ontology file. For <code class="docutils literal notranslate"><span class="pre">DialogFlow_CX</span></code>, the bot is parsed automatically via APIs.</p>
<p>The page subsequently require users to upload their revised dialog act maps and ontology files.</p>
</section>
<section id="dialog-generation-and-simulation">
<h2>3. Dialog Generation and Simulation<a class="headerlink" href="#dialog-generation-and-simulation" title="Permalink to this heading"></a></h2>
<a class="reference internal image-reference" href="_images/simulation.png"><img alt="_images/simulation.png" src="_images/simulation.png" style="width: 550px;" /></a>
<p>On this page, users can select intents they are interested for evaluation from the multi-selection list. They can also select which dataset to perform
the dialog simulation by checking the two options: <code class="docutils literal notranslate"><span class="pre">Simulation</span> <span class="pre">on</span> <span class="pre">held-out</span> <span class="pre">evaluation</span> <span class="pre">set</span></code> and <code class="docutils literal notranslate"><span class="pre">Simulation</span> <span class="pre">on</span> <span class="pre">dev</span> <span class="pre">set</span></code>.</p>
<p>The two datasets are created automatically from the original intent training utterances and used as follows:</p>
<ol class="arabic simple">
<li><p>The orignal intent utterance set is split into two non-overlapping set (70-30 dev-eval split by default). The evaluation utterances are kept to benchmark difference changes to the intent models.</p></li>
<li><p>Apply paraphrasing models to the two datasets to generate the paraphrase intent queries for the simulation goals.</p></li>
<li><p>The simulation goals created from the <code class="docutils literal notranslate"><span class="pre">dev</span></code> paraphrase intent queries are used to evaluate the current bot models via dialog simulation.</p></li>
<li><p>After applying remediation suggestions based on the simulated conversations on the <code class="docutils literal notranslate"><span class="pre">dev</span></code> goal set, the <code class="docutils literal notranslate"><span class="pre">eval</span></code> goals can be used to compare the bot performance and verify the efficacy of the remediation.</p></li>
</ol>
<p>The simulation will start in the background after <code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">Dialog</span> <span class="pre">Simulation</span></code> button is clicked.</p>
</section>
<section id="health-reports-and-analytics">
<h2>4. Health Reports and Analytics<a class="headerlink" href="#health-reports-and-analytics" title="Permalink to this heading"></a></h2>
<p>The simulation performance will be presented in the dashboard upon completion of the dialog simulation.
The App uses a database to store all previous simulations so that users can have a historcal comparison of their bot performance across
different changes applied.</p>
<p>The left panel allows users to select a particular test session (<code class="docutils literal notranslate"><span class="pre">Choose</span> <span class="pre">Test</span> <span class="pre">ID</span></code>) and perform the following actions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Check</span> <span class="pre">Summary</span> <span class="pre">Reports</span></code> for the aggregated performance of the test session including all intents.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Check</span> <span class="pre">Detailed</span> <span class="pre">Reports</span></code> for the detailed performance of the selected intent.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Investigate</span> <span class="pre">Dialog</span></code> to analyze the simulated conversations of the selected intent and present the remediation suggestions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Conversational</span> <span class="pre">Analytics</span></code> to present the intent model confusion matrix and tSNE visualisation of the intent training utterances.</p></li>
</ul>
<p>The dashboard reports are detailed in the <a class="reference external" href="https://">Remediator Dashboard Navigation</a> section.</p>
</section>
</section>
<section id="botsim-command-line-tools">
<h1>BotSIM command line tools<a class="headerlink" href="#botsim-command-line-tools" title="Permalink to this heading"></a></h1>
<p>This is a tutorial for applying BotSIM’s generation-simulation-remediation pipeline with command line tools.</p>
<section id="step-1-prepare-botsim-configuration-file">
<h2>Step 1: Prepare BotSIM configuration file<a class="headerlink" href="#step-1-prepare-botsim-configuration-file" title="Permalink to this heading"></a></h2>
<p>A template config.json has been provided in the repo and presented in the previous section. It includes all the necessary info needed for each module (generator, simulator and remediator).
The config file is used by the command line tools to save users troubles in setting these parameters. Users can also change the config to customise the simulation,
such as the dev/eval intents, paraphrasing settings, simulation run-time setting, etc. One important setting is the API credentials (the <code class="docutils literal notranslate"><span class="pre">api</span></code> slot)
so that BotSIM can call the bot APIs to perform dialog simulation.</p>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">Einstein</span> <span class="pre">BotBuilder</span></code>, the required inputs include <code class="docutils literal notranslate"><span class="pre">end_point</span></code>, <code class="docutils literal notranslate"><span class="pre">org_Id</span></code>, <code class="docutils literal notranslate"><span class="pre">deployment_Id</span></code> and <code class="docutils literal notranslate"><span class="pre">button_Id</span></code>.
They are readily available in the Einstein Bot section of the Salesforce org after a bot has been configured.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">DialogFlow</span> <span class="pre">CX</span></code>, the required fields include <code class="docutils literal notranslate"><span class="pre">location_id</span></code>, <code class="docutils literal notranslate"><span class="pre">agent_id</span></code>, <code class="docutils literal notranslate"><span class="pre">project_id</span></code> and <code class="docutils literal notranslate"><span class="pre">cx_credential</span></code>. They can be obtained from
users’ Google Cloud Platform console.</p></li>
</ul>
<p>Given a new test (test_id), the config.json can be customised by the command below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python botsim/cli/prepare_botsim.py <span class="se">\</span>
    --platform <span class="nv">$platform</span> <span class="se">\</span>
    --api_credential <span class="nv">$api</span> <span class="se">\</span>
    --test_name <span class="nv">$test_id</span> <span class="se">\</span>
    --num_seed_utterances <span class="nv">$num_seed_utterances</span> <span class="se">\</span>
    --num_t5_paraphrases <span class="nv">$num_t5_paraphrases</span> <span class="se">\</span>
    --num_pegasus_paraphrases <span class="nv">$num_pegasus_paraphrases</span> <span class="se">\</span>
    --max_num_simulations <span class="nv">$max_num_simulations</span> <span class="se">\</span>
    --max_num_dialog_turns <span class="nv">$max_num_dialog_turns</span> <span class="se">\</span>
    --metadata_botversions <span class="nv">$bot_version_path</span><span class="se">\</span>
    --metadata_intent_utterances <span class="nv">$mlDomain_path</span>
</pre></div>
</div>
<p>The command line options include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">platform</span></code> is the bot platform name, currently only <code class="docutils literal notranslate"><span class="pre">Einstein_Bot</span></code> and <code class="docutils literal notranslate"><span class="pre">DialogFlow_CX</span></code> are support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">api_credential</span></code> is the path of the bot API credentials in JSON format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_name</span></code> can be used to name the test session.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_seed_utterances</span></code> is the number of intent utterances used for generating paraphrase intent queries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_t5_paraphrases</span></code> is the number of paraphrases generated by the T5 paraphraser per utterance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_pegasus_paraphrases</span></code> is the number of paraphrases generated by the Pegasus paraphraser per utterance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_num_simulations</span></code> is the maximum number of dialog simulation episodes allowed for each intent.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_num_dialog_turns</span></code> is the maxmum number of dialog turns allowed for one episode</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metadata_botversions</span></code> and <code class="docutils literal notranslate"><span class="pre">metadata_intent_utterances</span></code> are only applicable to <code class="docutils literal notranslate"><span class="pre">Einstein_Bot</span></code> platform. They are the paths of the previously
retrieved metadata in the previous session.</p></li>
</ul>
</section>
<section id="stage-2-generation">
<h2>Stage 2: Generation<a class="headerlink" href="#stage-2-generation" title="Permalink to this heading"></a></h2>
<p>The parser of the generator module is used to generate a set of essential files for BotSIM to perform dialog user simulation via bot APIs.</p>
<ol class="arabic">
<li><p>Parsing metadata
Based on the setups in config.json, the metadata can be parsed using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python botsim/cli/run_generator_parser.py <span class="se">\</span>
  --platform <span class="nv">$platform</span> <span class="se">\</span>
  --test_name <span class="nv">$test_id</span>
</pre></div>
</div>
<p>This will parse the raw metadata inputs (for <code class="docutils literal notranslate"><span class="pre">Einstein_Bot</span></code>) or call APIs (for <code class="docutils literal notranslate"><span class="pre">DialogFlow_CX</span></code>) to generate the following template files for BotSIM to simulate conversations.</p>
<blockquote>
<div><ul>
<li><p><strong>[NLU] Dialog act maps for natural language understanding of bot messages</strong>: The template is used to map bot messages to semantic-level dialog acts via fuzzy matching.</p>
<p>The approach is adopted for the following reasons:  1) BotSIM is designed for commercial task-oriented dialog systems 2) most of the commercial chatbots adopt a “rule-action-message” scheme,
where there are clear defined or easily inferred mappings from bot messages to rules/actions. 3) not every bot platform supports intent detection APIs to use  4) template-matching is resource
and cost effective than calling intent APIs powered by the neural-based intent models.
A snippet of the automatically generated dialog act map for the dialog intent <code class="docutils literal notranslate"><span class="pre">check</span> <span class="pre">the</span> <span class="pre">status</span> <span class="pre">of</span> <span class="pre">an</span> <span class="pre">existing</span> <span class="pre">issue</span></code> is given below. The dialog acts inside each box come from the same sub-dialog.</p>
<a class="reference internal image-reference" href="_images/BotSIM_dialog_act_map.png"><img alt="_images/BotSIM_dialog_act_map.png" src="_images/BotSIM_dialog_act_map.png" style="width: 550px;" /></a>
<p>In particular, there are two special templates, namely “dialog_success_message” and “intent_success_message”, which are used to determine whether the task has been successfully completed or the correct
intent has been successfully detected. In other words, they serve as ground truth messages and directly affect the performance metrics such as task-completion rates and intent accuracies.  The messages
are created according to some heuristics: treating the first message with “request” action as the intent success message  and last message as the dialog success message. Therefore, users are required
to review these messages and ensure their correctness. For example, they can revise them or add additional messages.</p>
</li>
<li><p><strong>Human-in-the-loop revision of dialog act maps</strong></p>
<p>To save significant manual efforts, BotSIM parser adopts a conversation graph modelling approach to automatically generate the dialog act maps, which would be prohibitively demanding
if not possible for bot admins to craft from their bot designs.  Although the heave-lifting is done by the parser,
users are still required to carefully review the generated dialog act maps file to ensure their correctness as the only human-in-the-loop step of the BotSIM pipeline.</p>
<blockquote>
<div><ul>
<li><p><strong>intent_success_messages</strong>: The candidates of the intent_success_message correspond to bot messages signalling a successful intent classification.
It is by default the first “request” message as generated by the parser.  Some guidelines are listed below:</p>
<blockquote>
<div><ol class="arabic">
<li><p>It is essential to guarantee that no two intents/dialogs have the same intent_success_message. If these two intents have the same first “request” messages, try to differentiate them by including their first distinct messages into “intent_success_message”. For example, “Check the status of an order” and “Check the status of an issue” both have the entry message of “I can help with that.” The two dialogs differ in the next message, where the former asks an order number “Do you have your order number?” and the latter asks for an issue number “Do you have your case number?”.  We can thus use these two questions for their intent_success_message entries.</p></li>
<li><p>Multiple consecutive messages can be combined as one entry. For the previous example, we can also combine the entry message and the question message and use “I can help with that. Do you have your order number?” as one of the candidate messages for “intent_success_message”</p></li>
<li><p>Adding more candidates is sometimes helpful. BotSIM users are advised to include more (intent-specific) messages to make the intent classification more robust. Such messages may include</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Some representative messages from the intermediate steps that the conversation must go through. For example, the message corresponding to “request_Email” for “Check the status of an existing issue” can be used as a candidate for “intent_success_message” since it is a mandatory step for the dialog.</p></li>
<li><p>Messages under the “small_talk” section, which are specific to this particular intent</p></li>
</ol>
</div></blockquote>
</li>
<li><p>Sometimes candidates of other dialog acts are also need to be revised.</p></li>
<li><p>The revision may sometimes need help from bot designers.</p></li>
</ol>
</div></blockquote>
</li>
<li><dl>
<dt><strong>dialog_success_messages</strong>:</dt><dd><p>The candidate messages of dialog_success_message include bot messages that can be viewed as the successful completion of a dialog. Good candidates are the messages
at the end of a dialog. Such messages are usually used to inform users the final outcomes of the conversation. Note for some dialogs, there are multiple outcomes with contrasting messages, we treat
all these outcomes as “successful” messages. For example, for “Check the status of an existing issue” intent, if users have their case numbers and successfully authenticate themselves,
the dialog produces the first success message, otherwise the second message is displayed indicating a human agent will take over the case.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="nt">&quot;dialog_success_message&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">         </span><span class="s2">&quot;Thank you. One moment while I look up your case...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="s2">&quot;Oh, alright. Let\u2019s connect you to a service agent who can help look up your case&quot;</span><span class="w"></span>
<span class="w">     </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p><strong>small_talks</strong>: For messages that do not have any associated actions (request/inform etc.), we put them under the small_talks act. They will be ignored by BotSIM during dialog simulation. Examples include “I can help you with that”, “Got it”.</p></li>
<li><p><strong>request_intent</strong>: The bot messages of request_intent usually are the welcome messages if available (e.g., Einstein BotBuilder).</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>[NLG] BotSIM natural language response templates</strong></p>
<p>BotSIM adopts a dialog-act-level agenda-based user simulator for dialog simulation.  As shown in the previous dialog act map figure, BotSIM needs to convert the dialog acts to natural language
messages and send them back to bot via API. For efficiency reasons,
template-based NLG templates are used to map BotSIM dialog acts to natural language templates with entity slots. An example is given below for the “informing” the “email” slot to the bot.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w"> </span><span class="nt">&quot;dia_act&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="nt">&quot;inform&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">             </span><span class="p">{</span><span class="w"></span>
<span class="w">                 </span><span class="nt">&quot;request_slots&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"></span>
<span class="w">                 </span><span class="nt">&quot;inform_slots&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                     </span><span class="s2">&quot;email&quot;</span><span class="w"></span>
<span class="w">                 </span><span class="p">],</span><span class="w"></span>
<span class="w">                 </span><span class="nt">&quot;response&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                     </span><span class="nt">&quot;agent&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"></span>
<span class="w">                     </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                         </span><span class="s2">&quot;$email$.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="s2">&quot;It&#39;s $email$.&quot;</span><span class="w"></span>
<span class="w">                     </span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="p">}</span><span class="w"></span>

<span class="w">             </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="p">]</span><span class="w"></span>
<span class="w">     </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Given a dialog act, e.g., “request_email”, a response is randomly chosen from a set of pre-defined templates (“response”) with a “email” slot, which is replaced by the value in the goal during
dialog simulation. To increase the diversity and improve the naturalness of the responses, users are advised to adding more templates gradually for more robust evaluation of the NER model.</p>
</li>
<li><p><strong>[Entity] ontology</strong>
The ontology file is another parser output to include the set of entities used by each dialog/intent. An snippet of the file is given below for the entities of dialog “Check the status of an existing issue”.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;Check_the_status_of_an_existing_issue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;Case_Comments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;BJFHB3&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;Case_Number&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;CV85HX&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;Email_for_Look_Up&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;reginalyons@reed.net&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;haynesjohn@wood.com&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;melaniejones@juarez-alexander.com&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;kristen02@gmail.com&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note these values will be used to replace the slots in the previously discussed template NLG. These values are mostly related to BotSIM users’ customer or product info and BotSIM does not have access to
such values. Therefore, the slots are initialised by randomly generated  fake values. Together with the template-based NLG, they are used to evaluate the entity recognition performance.
The entity extraction can be model-based or regular extraction based. For example, users can replace the fake values with real ones to improve the reliability of the entity recognition performance.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Applying paraphrasing and generating simulation goals
In addition to parsing raw metadata input, another major function of the generator to prepare the simulation goals. These are analogous to “bot testing data”.
The goal defines a set of dialog act and slot-value pairs needed to complete a certain task.  An example goal of the “check the status of an existing issue” intent is given below:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;Goal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;Check_the_status_of_an_existing_issue_0&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;inform_slots&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;Has_case_number@_Boolean&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;Case_Number@Case_Number_Entity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;P3V4S6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;Email_for_Look_Up@Email_Address_Entity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;andrewadams@example.org&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;intent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;I would like to know more about my issue.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;Needs_transfer_to_agent@_Boolean&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;Needs_something_else@_Boolean&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;Goodbye@Goodbye_Entity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;goodbye&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;Needs_to_add_case_comment@_Boolean&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;Case_Comments@_Text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;P94RMU&quot;</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>

<span class="w">          </span><span class="nt">&quot;request_slots&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;Check_the_status_of_an_existing_issue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UNK&quot;</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>

<span class="w">          </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Check_the_status_of_an_existing_issue&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>The dialog acts and slots are obtained from the dialog act maps and the slot values are sampled from the ontology file except the special “intent” slot.
While most of the other slots are designed to evaluate the entity recognition performance, the “intent” values are used as the intent queries to probe the intent models.
To save human efforts in crafting such intent queries and to enable deployment testing, BotSIM adopts an ensemble of paraphrasing models to generate the paraphrases from
the input intent utterances to simulate the language variations in real user intent queries. The test scale can be controlled by setting  the number of paraphrases generated for each intent utterance
and number of goals to be sampled.
All these paraphrases can be set in the config json file. In addition, it is important to ensure the dialog act maps and ontology files have been revised before proceeding the following generation steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python botsim/cli/run_generator_paraphraser.py <span class="se">\</span>
    --platform <span class="nv">$platform</span> <span class="se">\</span>
    --test_name <span class="nv">$test_id</span>

python botsim/cli/run_generator_goal_generation.py <span class="se">\</span>
    --platform <span class="nv">$platform</span> <span class="se">\</span>
    --test_name <span class="nv">$test_id</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="step-3-dialog-simulation">
<h2>Step 3: Dialog Simulation<a class="headerlink" href="#step-3-dialog-simulation" title="Permalink to this heading"></a></h2>
<p>After preparing the goals (bot test data), the NLU (dialog act maps) and NLG (response templates) models, the simulator performs dialog simulation via API calls to complete the tasks defined in the goals.
An illustration of the exchange of conversations between BotSIM and the bot is given below:</p>
<a class="reference internal image-reference" href="_images/BotSIM_simulation_loop.png"><img alt="_images/BotSIM_simulation_loop.png" src="_images/BotSIM_simulation_loop.png" style="width: 550px;" /></a>
<p>Based on the dialog acts matched by the NLU, the state manager applies the corresponding rules to generate the user dialog acts.
They are then converted to natural language responses by the NLG and sent back to the bot. The conversation ends when the task has been successfully finished or an error has been captured.
By default, all intents will be included for simulation and they can be customised in the config file. In addition,
the simulation run-time parameters such as the maximum number of conversation turns allowed per simulated conversation,
the index of the dialog turn for fuzzy-matching the intent query response messages, should also be specified before simulation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python botsim/cli/run_simulator.py <span class="se">\</span>
    --platform <span class="nv">$platform</span> <span class="se">\</span>
    --test_name <span class="nv">$test_id</span>
</pre></div>
</div>
</section>
<section id="stage-4-analyse-and-remediate">
<h2>Stage 4: Analyse and Remediate<a class="headerlink" href="#stage-4-analyse-and-remediate" title="Permalink to this heading"></a></h2>
<p>The remediator module analyses the simulated conversations and
- aggregates bot health reports
- performs conversation analytics (intent model confusion matrix analysis and tSNE visualisation of intent utterances)
- provides actionable suggestions to help diagnose, troubleshoot and improve the current bot systems.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python botsim/cli/run_remediator.py <span class="se">\</span>
  --platform <span class="nv">$platform</span> <span class="se">\</span>
  --test_name <span class="nv">$test_id</span>
</pre></div>
</div>
</div></blockquote>
<p>For each intent/dialog and mode (dev/eval) specified in the config file, the following outputs will be produced to help user gauge system performance and take next-step actions:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">simulated_dialogs</span></code> file contains all the simulated dialogs, the error info (if any) associated with each simulated dialog</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intent_predictions</span></code> maps all the intent queries and their predicted intent labels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intent_remediation</span></code> is used to help users further examine and fix some intent errors. It lists all the original intent utterances who have at least one of their paraphrase intent queries wrongly predicted by the intent model. In addition, the wrongly predicted paraphrases are grouped by their predicted intent labels. For each group, suggestions are provided as possible next-step actions to take for fixing some of the identified errors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ner_errors</span></code> is used to collect the identified NER errors, including the dialog turns, slots, wrongly extracted or missed values. Furthermore, based on the extraction type of the entity, it also provides remediation suggestions.</p></li>
</ol>
<p>All the outputs are in JSON format so that they can be easily consumed by bot practitioners to take further actions. Note the suggestions are meant to be used as guidelines rather than strictly followed.
More importantly, they can always be extended to include domain expertise in troubleshooting bots related to their products/services.</p>
<p>The remediator also aggregates all the previous outputs into one single “aggregated_report.json” to present them in the bot health report dashboard. We will present the dashboard in more detail.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="deep_dive.html" class="btn btn-neutral float-left" title="Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dashboard.html" class="btn btn-neutral float-right" title="Remediator Dashboard Navigation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, salesforce.com inc..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>